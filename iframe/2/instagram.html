<!DOCTYPE html>
<title>Content from Instagram</title>
<body style="margin:0">
<script>
((hash, window) =>
{
	// Instagram's dark theme does not seem to be actually usable as of 2022-05-04
	//const isDark = /#theme=dark/.test(hash);
	const isDark = false;

	window.onload = () =>
	{
		const url = '//www.instagram.com/p/' + hash.replace(/#.*|[^-\w]/g, '');

		// NOTE: Instagram expects the hash to be a JSON object with an "os" element
		document.body.innerHTML = '<iframe allowfullscreen="" loading="eager" scrolling="no" style="background:#' + (isDark ? '000': 'fff') + ';border:solid 1px #' + (isDark ? '363636' : 'dbdbdb') + ';border-radius:3px;box-sizing:border-box;height:100vh;width:100%" src="' + url + '/embed/captioned/?cr=1&wp=' + window.innerWidth + (isDark ? '&theme=dark' : '') + '#%7B%22os%22%3A1%7D"></iframe><a target="_blank" style="display:block;line-height:100vh;position:absolute;text-align:center;top:0;width:100%" href=' + url + '>Loading Instagram...</a>';

		const iframe  = /** @type {!HTMLIFrameElement} */ (document.querySelector('iframe'));
		iframe.onload = () => iframe.nextElementSibling.remove();
	};

	let height, port;
	window.onmessage = (e) =>
	{
		const m = /MEASURE.*height\":(\d+)/.exec(e.data);
		if (m)
		{
			height = +m[1] + 2;
		}
		else if (e.data === 's9e:init')
		{
			port = e.ports[0];
			e.stopImmediatePropagation();
		}
		else
		{
			// Ignore messages that we don't recognize
			return;
		}

		if (height && port)
		{
			port.postMessage(height);
		}
	};
})(location.hash.substring(1), window);
</script>