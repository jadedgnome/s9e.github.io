<!DOCTYPE html>
<title>Content from Facebook</title>
<link rel="preconnect" crossorigin="" href="//www.facebook.com">
<body style="margin:0">
<script>
((document, hash, window) =>
{
	// This should handle the very old #123 form, the modern #p123 form and the yet-unused
	// #pfbidXXX version
	const [type, id] = ((m) =>
	{
		if (m)
		{
			return [/p/.test(hash) ? 'post' : 'video', m[1]];
		}

		return ['post', hash.replace(/\W/g, '')];
	})(/^#[pv](\d+)$/.exec(hash));

	const body = document.body,
	      path = (type === 'post') ? 'user/' : 'v/',
	      lang = (window.navigator || {}).language || 'enUS';

	body.innerHTML = '<div data-href=//www.facebook.com/' + path + type + 's/' + id + ' class=fb-' + type + ((window.innerWidth === 640) ? ' data-width=640' : '') + '>Cannot load Facebook SDK. Disable any adblocker or tracking protection and try again.</div>';

	window.onmessage = (e) =>
	{
		if (e.data !== 's9e:init')
		{
			return;
		}

		const script = document.createElement('script');
		script.src = '//connect.facebook.net/' + lang.substring(0, 2) + '_' + lang.toUpperCase().substring(lang.length - 2) + '/sdk.js#xfbml=1&version=v15.0';
		body.appendChild(script);

		let delay     = 48,
			height    = 0,
			port      = e.ports[0],
			timeoutId = 0;
		function getHeight()
		{
			return Math.ceil(document.documentElement.getBoundingClientRect().height);
		}
		function schedule()
		{
			clearTimeout(timeoutId);
			timeoutId = setTimeout(
				() =>
				{
					if (height === (height = getHeight()) || height < 90)
					{
						delay += 12;
					}
					else
					{
						port.postMessage(height);
					}
					if (delay < 1000)
					{
						schedule();
					}
				},
				delay
			);
		}
		window.onclick = window.onresize = () =>
		{
			delay = 48;
			schedule();
		};
		schedule();
	};
})(document, location.hash, window);
</script>