<!DOCTYPE html>
<title>Content from Imgur</title>
<body style="margin:0">
<script>
(function (body)
{
	// Replace %2F with / to handle [media=imgur]gallery/xyz[/media] in XF 1.x
	// Replace non-word characters to avoid HTML injections
	body.innerHTML = '<iframe allowfullscreen="" scrolling="no" style="border:solid 1px #ddd;border-radius:2px;height:398px;width:calc(100% - 2px)" src="//imgur.com' + location.hash.replace(/g(a)llery\/|%2F|\W/g, '$1/') + '/embed?pub=true&w=' + innerWidth + '"></iframe>';

	let height, port, width;
	onmessage = function (e)
	{
		let m;
		if (e.data === 's9e:init')
		{
			port = e.ports[0];
			e.stopImmediatePropagation();
		}
		else if (m = /height":(\d+),"width":(\d+)/.exec(e.data))
		{
			height = +m[1];
			width  = +m[2];

			body.firstChild.style.height = height + 'px';
			body.firstChild.style.width  = width + 'px';
		}

		// NOTE: Imgur sometimes reports 0 width
		if (height && port && width)
		{
			port.postMessage((height + 2) + ' ' + (width + 2));
		}
	};
})(document.body);
</script>